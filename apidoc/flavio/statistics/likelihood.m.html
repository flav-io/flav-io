<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>flavio.statistics.likelihood API documentation</title>
    <meta name="description" content="" />

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/public/plugins/katex/katex.min.css">
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

    .katex {
      font-size:1em;
    }
    .katex .mathit, .katex .mathrm {
      font-family: 'Noto Sans';
    }
  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Noto Sans", "Helvetica Neue", Helvetica, sans;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
    <script src="/public/plugins/katex/katex.min.js"></script>
    <script src="/public/plugins/katex/auto-render.min.js"></script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.FastLikelihood">FastLikelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.dump">dump</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.get_yaml_dict">get_yaml_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.log_likelihood">log_likelihood</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.make_measurement">make_measurement</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.set_description">set_description</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.clear_all">clear_all</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.del_instance">del_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.find">find</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.get_instance">get_instance</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.input_schema">input_schema</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.FastLikelihood.output_schema">output_schema</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.Likelihood">Likelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.dump">dump</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.get_yaml_dict">get_yaml_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.log_likelihood">log_likelihood</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.log_likelihood_exp">log_likelihood_exp</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.log_prior_fit_parameters">log_prior_fit_parameters</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.input_schema">input_schema</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.Likelihood.output_schema">output_schema</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.MeasurementCovariance">MeasurementCovariance</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.compute">compute</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.get">get</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementCovariance.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.MeasurementLikelihood">MeasurementLikelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.dump">dump</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.get_number_observations">get_number_observations</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.get_predictions_par">get_predictions_par</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.get_yaml_dict">get_yaml_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_par">log_likelihood_par</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_pred">log_likelihood_pred</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.input_schema">input_schema</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.MeasurementLikelihood.output_schema">output_schema</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.ParameterLikelihood">ParameterLikelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.dump">dump</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.get_yaml_dict">get_yaml_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.log_likelihood_par">log_likelihood_par</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.input_schema">input_schema</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.ParameterLikelihood.output_schema">output_schema</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#flavio.statistics.likelihood.SMCovariance">SMCovariance</a></span>
        
          
  <ul>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.__init__">__init__</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.compute">compute</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.get">get</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.load">load</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.load_dict">load_dict</a></li>
    <li class="mono"><a href="#flavio.statistics.likelihood.SMCovariance.save">save</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">flavio.statistics.likelihood</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">flavio</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">voluptuous</span> <span class="k">as</span> <span class="nn">vol</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">flavio.classes</span> <span class="kn">import</span> <span class="n">NamedInstanceClass</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.probability</span> <span class="kn">import</span> <span class="n">NormalDistribution</span><span class="p">,</span> <span class="n">MultivariateNormalDistribution</span>
<span class="kn">from</span> <span class="nn">flavio.io</span> <span class="kn">import</span> <span class="n">instanceio</span> <span class="k">as</span> <span class="n">iio</span>


<span class="k">class</span> <span class="nc">MeasurementLikelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `MeasurementLikelihood` provides a likelihood function from</span>
<span class="sd">    experimental measurements.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `get_predictions_par`: Return a dictionary of SM predictions for the</span>
<span class="sd">    observables of interest</span>
<span class="sd">    - `log_likelihood_pred`: The likelihood as a function of the predictions</span>
<span class="sd">    - `log_likelihood_par`: The likelihood as a function of parameters and</span>
<span class="sd">    Wilson coefficients</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `observables`: list of observables (tuples or strings)</span>
<span class="sd">        - `exclude_measurements`: list of measurement names to exclude</span>
<span class="sd">        (default: none ar excluded)</span>
<span class="sd">        - `include_measurements`: list of measurement names to include</span>
<span class="sd">        (default: all are included)</span>

<span class="sd">        Only one of `exclude_measurements` or `include_measurements` should</span>
<span class="sd">        be specified. By default, all existing instances of</span>
<span class="sd">        `flavio.Measurements` are included as constraints (except if they</span>
<span class="sd">        carry &#39;Pseudo-measurement&#39; in their name).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_pseudo_measurements</span> <span class="o">=</span> <span class="n">include_pseudo_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>

        <span class="c1"># check that observables are constrained</span>
        <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_warn_meas_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warn the user if the fit contains multiple correlated measurements of</span>
<span class="sd">        an observable that is not included in the fit parameters, as this will</span>
<span class="sd">        lead to inconsistent results.&quot;&quot;&quot;</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># iterate over all measurements constraining at least one fit obs.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># iterate over all fit obs. constrained by this measurement</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">):</span>
                <span class="c1"># the constraint on this fit obs.</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># find all the other obs. constrained by this constraint</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">constraint</span><span class="p">:</span>
                        <span class="n">par</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
                    <span class="c1"># if the other obs. are not fit obs., append them to the list</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1"># replace list by a Counter</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="c1"># warn for all counts &gt; 1</span>
        <span class="k">for</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> of the measurements in the likelihood &quot;</span>
                                   <span class="s2">&quot;constrain both &#39;</span><span class="si">{}</span><span class="s2">&#39; and &#39;</span><span class="si">{}</span><span class="s2">&#39;, but only the &quot;</span>
                                   <span class="s2">&quot;latter is included among the fit &quot;</span>
                                   <span class="s2">&quot;observables. This can lead to inconsistent &quot;</span>
                                   <span class="s2">&quot;results as the former is profiled over.&quot;</span>
                                   <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">corr_with</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all the measurements currently defined that</span>
<span class="sd">        constrain any of the fit observables.&quot;&quot;&quot;</span>
        <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">m_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pseudo-measurement&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_pseudo_measurements</span><span class="p">:</span>
                <span class="c1"># skip pseudo measurements generated by FastFit instances</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1"># if set of all observables constrained by measurement is disjoint</span>
                <span class="c1"># with fit observables, do nothing</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># else, add measurement name to output list</span>
                <span class="n">all_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_measurements</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the predictions for all observables as functions of</span>
<span class="sd">        a parameter dictionary `par_dict`and WilsonCoefficient instance</span>
<span class="sd">        `wc_obj`.</span>
<span class="sd">        The latest computed values are cached and returned if the function is</span>
<span class="sd">        called successively with the same arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compute a hash from the function&#39;s arguments used for caching</span>
        <span class="n">arg_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="n">wc_obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">arg_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span><span class="p">:</span>
            <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">argument_format</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">obs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="n">all_predictions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="n">arg_hash</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span>

    <span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">        of observables.&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="n">our_obs</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="n">exclude_observables</span>
            <span class="c1"># add the number of observables contained in the measurement</span>
            <span class="c1"># and in our instance (except the excluded ones)</span>
            <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_obs</span> <span class="o">&amp;</span> <span class="n">our_obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nobs</span>


    <span class="k">def</span> <span class="nf">log_likelihood_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">        a dictionary of observable predictions `pred_dict`&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="c1"># exclude the observables not contained in the likelihood</span>
            <span class="c1"># as well as the ones explicitly excluded by `exclude_observables`</span>
            <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="n">m_obs</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">|</span> <span class="n">exclude_observables</span>
            <span class="k">if</span> <span class="n">m_obs</span> <span class="o">==</span> <span class="n">exclude_parameters</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># if all measured observables are excluded: nothing to do</span>
            <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">        a parameter dictionary `par_dict` and WilsonCoefficient instance</span>
<span class="sd">        `wc_obj`&quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_pred</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ParameterLikelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `ParameterLikelihood` provides a likelihood function in terms of</span>
<span class="sd">    parameters.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `log_likelihood_par`: The likelihood as a function of the parameters</span>
<span class="sd">    - `get_central`: get an array with the parameters&#39; central values</span>
<span class="sd">    - `get_random`: get an array with random values for the parameters</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `par_obj`: an instance of `ParameterConstraints` (defaults to</span>
<span class="sd">        `flavio.default_parameters`)</span>
<span class="sd">        - parameters: a list of parameters whose constraints should be taken</span>
<span class="sd">        into account in the likelihood.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all parameters.</span>

<span class="sd">        Note that only the parameters in `self.parameters` will give a</span>
<span class="sd">        contribution to the likelihood.&quot;&quot;&quot;</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">Likelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `Likelihood` provides a likelihood function consisting of a</span>
<span class="sd">    contribution from experimental measurements and a contribution from</span>
<span class="sd">    parameters.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `log_prior_fit_parameters`: The parameter contribution to the</span>
<span class="sd">    log-likelihood</span>
<span class="sd">    - `log_likelihood_exp`: The experimental contribution to the</span>
<span class="sd">    log-likelihood</span>
<span class="sd">    - `log_likelihood`: The total log-likelihood that is the sum of the</span>
<span class="sd">    parameter and the experimental contribution</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
            <span class="n">observables</span><span class="p">,</span>
            <span class="n">exclude_measurements</span><span class="o">=</span><span class="n">exclude_measurements</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="n">include_measurements</span><span class="p">,</span>
            <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="n">include_pseudo_measurements</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span> <span class="o">=</span> <span class="n">ParameterLikelihood</span><span class="p">(</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="n">par_obj</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">fit_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_prior_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameter contribution to the log-likelihood.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># nothing to do</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Experimental contribution to the log-likelihood.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total log-likelihood.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `par_dict`: a dictionary of parameter values</span>
<span class="sd">        - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_fit_parameters</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SMCovariance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to compute, save, and load a covariance matrix of SM</span>
<span class="sd">    predictions.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `compute`: Compute the covariance</span>
<span class="sd">    - `get`: Compute the covariance if necessary, otherwise return cached one</span>
<span class="sd">    - `save`: Save the covariance to a file</span>
<span class="sd">    - `load`: Load the covariance from a file</span>
<span class="sd">    - `load_dict`: Load the covariance from a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">vary_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">par_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `observables`: list of observables</span>
<span class="sd">        - `vary_parameters`: parameters to vary. Defaults to &#39;all&#39;.</span>
<span class="sd">        - `par_obj`: instance of ParameterConstraints. Defaults to</span>
<span class="sd">        flavio.default_parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span> <span class="o">=</span> <span class="n">vary_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span> <span class="ow">or</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values, using `threads`</span>
<span class="sd">        CPU threads.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_covariance</span><span class="p">(</span><span class="n">obs_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                                    <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
                                    <span class="n">par_vary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span><span class="p">,</span>
                                    <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
                                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 100),</span>
<span class="sd">        using `threads` CPU threads (default: 1).</span>

<span class="sd">        If `force` is False, return a cached version if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>

<span class="sd">        The covariance must have been computed before using `get` or</span>
<span class="sd">        `compute`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="p">,</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>

<span class="sd">        It must have the form `{&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">        where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">        given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">MeasurementCovariance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to compute, save, and load a covariance matrix and the central</span>
<span class="sd">    values of experimental measurements.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `compute`: Compute the covariance</span>
<span class="sd">    - `get`: Compute the covariance if necessary, otherwise return cached one</span>
<span class="sd">    - `save`: Save the covariance to a file</span>
<span class="sd">    - `load`: Load the covariance from a file</span>
<span class="sd">    - `load_dict`: Load the covariance from a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_likelihood</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `measurement_likelihood`: an instance of `MeasurementLikelihood`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">measurement_likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values.&quot;&quot;&quot;</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">covariances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="c1"># obs. included in the fit and constrained by this measurement</span>
            <span class="n">our_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="c1"># construct a dict. containing a vector of N random values for</span>
            <span class="c1"># each of these observables</span>
            <span class="n">random_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">random_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> <span class="n">N</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">random_arr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">covariance</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">covariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
        <span class="c1"># if there is only a single measuement</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># if there is only a single observable</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if there are severeal measurements, perform a weighted average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># covariances: [Sigma_1, Sigma_2, ...]</span>
            <span class="c1"># means: [x_1, x_2, ...]</span>
            <span class="c1"># weights_ [W_1, W_2, ...] where W_i = (Sigma_i)^(-1)</span>
            <span class="c1"># weighted covariance is  (W_1 + W_2 + ...)^(-1) = Sigma</span>
            <span class="c1"># weigted mean is  Sigma.(W_1.x_1 + W_2.x_2 + ...) = x</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">])</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">weighted_covariance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">]</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weighted_covariance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">weighted_mean</span><span class="p">,</span> <span class="n">weighted_covariance</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 5000).</span>

<span class="sd">        If `force` is False, return a cached version if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covariance to a pickle</span>
<span class="sd">        file.</span>

<span class="sd">        The central values and the covariance must have been computed before</span>
<span class="sd">        using `get` or `compute`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covariance from a</span>
<span class="sd">        dictionary.</span>

<span class="sd">        It must have the form</span>
<span class="sd">        `{&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">        where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">        covariance matrix, both in the basis of observables given by</span>
<span class="sd">        &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span> <span class="n">permutation</span><span class="p">],</span>
            <span class="p">)</span>


<span class="k">class</span> <span class="nc">FastLikelihood</span><span class="p">(</span><span class="n">NamedInstanceClass</span><span class="p">,</span> <span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A variant (but not subclass) of `Likelihood` where some or all</span>
<span class="sd">    of the parameters have been &quot;integrated out&quot; and their theoretical</span>
<span class="sd">    uncertainties combined with the experimental uncertainties into</span>
<span class="sd">    a multivariate Gaussian &quot;pseudo measurement&quot;.</span>

<span class="sd">    The pseuo measurement is generated by calling the method `make_measurement`.</span>
<span class="sd">    This is done by</span>
<span class="sd">    generating random samples of the nuisance parameters and evaluating all</span>
<span class="sd">    observables within the Standard Model many times (100 by default).</span>
<span class="sd">    Then, the covariance of all predictions is extracted. Similarly, a covariance</span>
<span class="sd">    matrix for all experimental measurements is determined. Both covariance</span>
<span class="sd">    matrices are added and the resulting multivariate Gaussian treated as a</span>
<span class="sd">    single measurement.</span>

<span class="sd">    This approach has the advantage that two-dimensional plots of the likelihood</span>
<span class="sd">    can be produced without the need for sampling or profiling the other</span>
<span class="sd">    dimensions. However, several strong assumptions go into this method, most</span>
<span class="sd">    importantly,</span>

<span class="sd">    - all uncertainties - experimental and theoretical - are treated as Gaussian</span>
<span class="sd">    - the theoretical uncertainties in the presence of new physics are assumed</span>
<span class="sd">      to be equal to the ones in the SM</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `make_measurement`: Generate the pseudo measurement</span>
<span class="sd">    - `log_likelihood`: The log-likelihood function</span>

<span class="sd">    Important attributes/properties:</span>

<span class="sd">    - `likelihood`: the `Likelihood` instance based on the pseudo measurement</span>
<span class="sd">    - `full_measurement_likelihood`: the `MeasurementLikelihood` instance based</span>
<span class="sd">    on the original measurements</span>
<span class="sd">    - `sm_covariance`: the `SMCovariance` instance (that can be used to load</span>
<span class="sd">    and save the SM covariance matrix)</span>
<span class="sd">    - `exp_covariance`: the `MeasurementCovariance` instance (that can be used</span>
<span class="sd">    to load and save the experimental covariance matrix)</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">nuisance_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span> <span class="o">=</span> <span class="n">SMCovariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">vary_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">,</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span> <span class="o">=</span> <span class="n">MeasurementCovariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">NamedInstanceClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
        <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
        <span class="c1"># add the Pseudo-measurement</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastLikelihood instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="p">(</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
            <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">,</span>
            <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>  <span class="c1"># only include our pseudo-meas.</span>
            <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># force including the pseudo-meas.</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to call `make_measurement` first.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log-likelihood function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `par_dict`: a dictionary of parameter values</span>
<span class="sd">        - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.FastLikelihood" class="name">class <span class="ident">FastLikelihood</span></p>
      
  
    <div class="desc"><p>A variant (but not subclass) of <code>Likelihood</code> where some or all
of the parameters have been "integrated out" and their theoretical
uncertainties combined with the experimental uncertainties into
a multivariate Gaussian "pseudo measurement".</p>
<p>The pseuo measurement is generated by calling the method <code>make_measurement</code>.
This is done by
generating random samples of the nuisance parameters and evaluating all
observables within the Standard Model many times (100 by default).
Then, the covariance of all predictions is extracted. Similarly, a covariance
matrix for all experimental measurements is determined. Both covariance
matrices are added and the resulting multivariate Gaussian treated as a
single measurement.</p>
<p>This approach has the advantage that two-dimensional plots of the likelihood
can be produced without the need for sampling or profiling the other
dimensions. However, several strong assumptions go into this method, most
importantly,</p>
<ul>
<li>all uncertainties - experimental and theoretical - are treated as Gaussian</li>
<li>the theoretical uncertainties in the presence of new physics are assumed
  to be equal to the ones in the SM</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>make_measurement</code>: Generate the pseudo measurement</li>
<li><code>log_likelihood</code>: The log-likelihood function</li>
</ul>
<p>Important attributes/properties:</p>
<ul>
<li><code>likelihood</code>: the <code>Likelihood</code> instance based on the pseudo measurement</li>
<li><code>full_measurement_likelihood</code>: the <code>MeasurementLikelihood</code> instance based
on the original measurements</li>
<li><code>sm_covariance</code>: the <code>SMCovariance</code> instance (that can be used to load
and save the SM covariance matrix)</li>
<li><code>exp_covariance</code>: the <code>MeasurementCovariance</code> instance (that can be used
to load and save the experimental covariance matrix)</li>
</ul>
<p>Instances can be imported and exported from/to YAML using the <code>load</code>
and <code>dump</code> methods.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FastLikelihood</span><span class="p">(</span><span class="n">NamedInstanceClass</span><span class="p">,</span> <span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A variant (but not subclass) of `Likelihood` where some or all</span>
<span class="sd">    of the parameters have been &quot;integrated out&quot; and their theoretical</span>
<span class="sd">    uncertainties combined with the experimental uncertainties into</span>
<span class="sd">    a multivariate Gaussian &quot;pseudo measurement&quot;.</span>

<span class="sd">    The pseuo measurement is generated by calling the method `make_measurement`.</span>
<span class="sd">    This is done by</span>
<span class="sd">    generating random samples of the nuisance parameters and evaluating all</span>
<span class="sd">    observables within the Standard Model many times (100 by default).</span>
<span class="sd">    Then, the covariance of all predictions is extracted. Similarly, a covariance</span>
<span class="sd">    matrix for all experimental measurements is determined. Both covariance</span>
<span class="sd">    matrices are added and the resulting multivariate Gaussian treated as a</span>
<span class="sd">    single measurement.</span>

<span class="sd">    This approach has the advantage that two-dimensional plots of the likelihood</span>
<span class="sd">    can be produced without the need for sampling or profiling the other</span>
<span class="sd">    dimensions. However, several strong assumptions go into this method, most</span>
<span class="sd">    importantly,</span>

<span class="sd">    - all uncertainties - experimental and theoretical - are treated as Gaussian</span>
<span class="sd">    - the theoretical uncertainties in the presence of new physics are assumed</span>
<span class="sd">      to be equal to the ones in the SM</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `make_measurement`: Generate the pseudo measurement</span>
<span class="sd">    - `log_likelihood`: The log-likelihood function</span>

<span class="sd">    Important attributes/properties:</span>

<span class="sd">    - `likelihood`: the `Likelihood` instance based on the pseudo measurement</span>
<span class="sd">    - `full_measurement_likelihood`: the `MeasurementLikelihood` instance based</span>
<span class="sd">    on the original measurements</span>
<span class="sd">    - `sm_covariance`: the `SMCovariance` instance (that can be used to load</span>
<span class="sd">    and save the SM covariance matrix)</span>
<span class="sd">    - `exp_covariance`: the `MeasurementCovariance` instance (that can be used</span>
<span class="sd">    to load and save the experimental covariance matrix)</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;nuisance_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">nuisance_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span> <span class="o">=</span> <span class="n">SMCovariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">vary_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">,</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span> <span class="o">=</span> <span class="n">MeasurementCovariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">NamedInstanceClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
        <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
        <span class="c1"># add the Pseudo-measurement</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastLikelihood instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                    <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="p">(</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
            <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">,</span>
            <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>  <span class="c1"># only include our pseudo-meas.</span>
            <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># force including the pseudo-meas.</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to call `make_measurement` first.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log-likelihood function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `par_dict`: a dictionary of parameter values</span>
<span class="sd">        - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.FastLikelihood">FastLikelihood</a></li>
          <li>flavio.classes.NamedInstanceClass</li>
          <li>flavio.io.instanceio.YAMLLoadable</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, par_obj=&lt;flavio.classes.ParameterConstraints object at 0x7fb9bcfb0940&gt;, fit_parameters=None, nuisance_parameters=&#39;all&#39;, observables=None, exclude_measurements=None, include_measurements=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
             <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
             <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">nuisance_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
             <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">nuisance_parameters</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">all_parameters</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span> <span class="o">=</span> <span class="n">nuisance_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
        <span class="n">exclude_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">,</span>
        <span class="n">include_measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span> <span class="o">=</span> <span class="n">SMCovariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
        <span class="n">vary_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_parameters</span><span class="p">,</span>
        <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span> <span class="o">=</span> <span class="n">MeasurementCovariance</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_measurement_likelihood</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">NamedInstanceClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.dump">
    <p>def <span class="ident">dump</span>(</p><p>self, stream=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the objectto a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.dump', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.dump" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the objectto a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yaml_dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.get_yaml_dict">
    <p>def <span class="ident">get_yaml_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the object to a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.get_yaml_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.get_yaml_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_yaml_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the object to a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_schema</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c1"># remove NoneTypes and empty lists</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="p">[]}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.log_likelihood">
    <p>def <span class="ident">log_likelihood</span>(</p><p>self, par_dict, wc_obj, exclude_observables=None, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Log-likelihood function.</p>
<p>Parameters:
- <code>par_dict</code>: a dictionary of parameter values
- <code>wc_obj</code>: an instance of <code>WilsonCoefficients</code> or <code>wilson.Wilson</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.log_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.log_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log-likelihood function.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `par_dict`: a dictionary of parameter values</span>
<span class="sd">    - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.make_measurement">
    <p>def <span class="ident">make_measurement</span>(</p><p>self, N=100, Nexp=5000, threads=1, force=False, force_exp=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the likelihood by producing a pseudo-measurement containing both
experimental uncertainties as well as theory uncertainties stemming
from nuisance parameters.</p>
<p>Optional parameters:</p>
<ul>
<li><code>N</code>: number of random computations for the SM covariance (computing
  time is proportional to it; more means less random fluctuations.)</li>
<li><code>Nexp</code>: number of random computations for the experimental covariance.
  This is much less expensive than the theory covariance, so a large
  number can be afforded (default: 5000).</li>
<li><code>threads</code>: number of parallel threads for the SM
  covariance computation. Defaults to 1 (no parallelization).</li>
<li><code>force</code>: if True, will recompute SM covariance even if it
  already has been computed. Defaults to False.</li>
<li><code>force_exp</code>: if True, will recompute experimental central values and
  covariance even if they have already been computed. Defaults to False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.make_measurement', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.make_measurement" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_exp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">    experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">    from nuisance parameters.</span>
<span class="sd">    Optional parameters:</span>
<span class="sd">    - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">      time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">    - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">      This is much less expensive than the theory covariance, so a large</span>
<span class="sd">      number can be afforded (default: 5000).</span>
<span class="sd">    - `threads`: number of parallel threads for the SM</span>
<span class="sd">      covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">    - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">      already has been computed. Defaults to False.</span>
<span class="sd">    - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">      covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">central_exp</span><span class="p">,</span> <span class="n">cov_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Nexp</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force_exp</span><span class="p">)</span>
    <span class="n">cov_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
    <span class="n">covariance</span> <span class="o">=</span> <span class="n">cov_exp</span> <span class="o">+</span> <span class="n">cov_sm</span>
    <span class="c1"># add the Pseudo-measurement</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="s1">&#39;Pseudo-measurement for FastLikelihood instance: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">central_exp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># for a 1D (or 0D) array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                <span class="n">MultivariateNormalDistribution</span><span class="p">(</span><span class="n">central_exp</span><span class="p">,</span> <span class="n">covariance</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_measurement</span> <span class="o">=</span> <span class="n">m</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="p">(</span>
        <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
        <span class="n">fit_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">,</span>
        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
        <span class="n">include_measurements</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>  <span class="c1"># only include our pseudo-meas.</span>
        <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># force including the pseudo-meas.</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.set_description">
    <p>def <span class="ident">set_description</span>(</p><p>self, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.set_description', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.set_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.exclude_measurements" class="name">var <span class="ident">exclude_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.exp_covariance" class="name">var <span class="ident">exp_covariance</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.fit_parameters" class="name">var <span class="ident">fit_parameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.full_measurement_likelihood" class="name">var <span class="ident">full_measurement_likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.include_measurements" class="name">var <span class="ident">include_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.likelihood" class="name">var <span class="ident">likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.par_obj" class="name">var <span class="ident">par_obj</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.parameters_central" class="name">var <span class="ident">parameters_central</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.pseudo_measurement" class="name">var <span class="ident">pseudo_measurement</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.FastLikelihood.sm_covariance" class="name">var <span class="ident">sm_covariance</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.clear_all">
    <p>def <span class="ident">clear_all</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all instances.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.clear_all', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.clear_all" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete all instances.&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.del_instance">
    <p>def <span class="ident">del_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.del_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.del_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">del_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.find">
    <p>def <span class="ident">find</span>(</p><p>cls, regex)</p>
    </div>
    

    
  
    <div class="desc"><p>Find all instance names matching the regular expression <code>regex</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.find', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.find" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find all instance names matching the regular expression `regex`.&quot;&quot;&quot;</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.get_instance">
    <p>def <span class="ident">get_instance</span>(</p><p>cls, name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.get_instance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.get_instance" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.input_schema">
    <p>def <span class="ident">input_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.input_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.input_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">input_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_input_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">ALLOW_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.load">
    <p>def <span class="ident">load</span>(</p><p>cls, f, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.load" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>cls, d, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">input_schema</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.FastLikelihood.output_schema">
    <p>def <span class="ident">output_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.FastLikelihood.output_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.FastLikelihood.output_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">output_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_output_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">REMOVE_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.Likelihood" class="name">class <span class="ident">Likelihood</span></p>
      
  
    <div class="desc"><p>A <code>Likelihood</code> provides a likelihood function consisting of a
contribution from experimental measurements and a contribution from
parameters.</p>
<p>Methods:</p>
<ul>
<li><code>log_prior_fit_parameters</code>: The parameter contribution to the
log-likelihood</li>
<li><code>log_likelihood_exp</code>: The experimental contribution to the
log-likelihood</li>
<li><code>log_likelihood</code>: The total log-likelihood that is the sum of the
parameter and the experimental contribution</li>
</ul>
<p>Instances can be imported and exported from/to YAML using the <code>load</code>
and <code>dump</code> methods.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Likelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `Likelihood` provides a likelihood function consisting of a</span>
<span class="sd">    contribution from experimental measurements and a contribution from</span>
<span class="sd">    parameters.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `log_prior_fit_parameters`: The parameter contribution to the</span>
<span class="sd">    log-likelihood</span>
<span class="sd">    - `log_likelihood_exp`: The experimental contribution to the</span>
<span class="sd">    log-likelihood</span>
<span class="sd">    - `log_likelihood`: The total log-likelihood that is the sum of the</span>
<span class="sd">    parameter and the experimental contribution</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;fit_parameters&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
            <span class="n">observables</span><span class="p">,</span>
            <span class="n">exclude_measurements</span><span class="o">=</span><span class="n">exclude_measurements</span><span class="p">,</span>
            <span class="n">include_measurements</span><span class="o">=</span><span class="n">include_measurements</span><span class="p">,</span>
            <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="n">include_pseudo_measurements</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span> <span class="o">=</span> <span class="n">ParameterLikelihood</span><span class="p">(</span>
            <span class="n">par_obj</span><span class="o">=</span><span class="n">par_obj</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">fit_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_prior_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameter contribution to the log-likelihood.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># nothing to do</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Experimental contribution to the log-likelihood.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total log-likelihood.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `par_dict`: a dictionary of parameter values</span>
<span class="sd">        - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_fit_parameters</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.Likelihood">Likelihood</a></li>
          <li>flavio.io.instanceio.YAMLLoadable</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, par_obj=&lt;flavio.classes.ParameterConstraints object at 0x7fb9bcfb0940&gt;, fit_parameters=None, observables=None, exclude_measurements=None, include_measurements=None, include_pseudo_measurements=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
             <span class="n">fit_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">fit_parameters</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">MeasurementLikelihood</span><span class="p">(</span>
        <span class="n">observables</span><span class="p">,</span>
        <span class="n">exclude_measurements</span><span class="o">=</span><span class="n">exclude_measurements</span><span class="p">,</span>
        <span class="n">include_measurements</span><span class="o">=</span><span class="n">include_measurements</span><span class="p">,</span>
        <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="n">include_pseudo_measurements</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span> <span class="o">=</span> <span class="n">ParameterLikelihood</span><span class="p">(</span>
        <span class="n">par_obj</span><span class="o">=</span><span class="n">par_obj</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">fit_parameters</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.dump">
    <p>def <span class="ident">dump</span>(</p><p>self, stream=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the objectto a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.dump', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.dump" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the objectto a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yaml_dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.get_yaml_dict">
    <p>def <span class="ident">get_yaml_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the object to a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.get_yaml_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.get_yaml_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_yaml_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the object to a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_schema</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c1"># remove NoneTypes and empty lists</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="p">[]}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.log_likelihood">
    <p>def <span class="ident">log_likelihood</span>(</p><p>self, par_dict, wc_obj, exclude_observables=None, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Total log-likelihood.</p>
<p>Parameters:
- <code>par_dict</code>: a dictionary of parameter values
- <code>wc_obj</code>: an instance of <code>WilsonCoefficients</code> or <code>wilson.Wilson</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.log_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.log_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Total log-likelihood.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `par_dict`: a dictionary of parameter values</span>
<span class="sd">    - `wc_obj`: an instance of `WilsonCoefficients` or `wilson.Wilson`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior_fit_parameters</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_exp</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.log_likelihood_exp">
    <p>def <span class="ident">log_likelihood_exp</span>(</p><p>self, par_dict, wc_obj, exclude_observables=None, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Experimental contribution to the log-likelihood.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.log_likelihood_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.log_likelihood_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Experimental contribution to the log-likelihood.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.log_prior_fit_parameters">
    <p>def <span class="ident">log_prior_fit_parameters</span>(</p><p>self, par_dict, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Parameter contribution to the log-likelihood.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.log_prior_fit_parameters', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.log_prior_fit_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_prior_fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parameter contribution to the log-likelihood.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># nothing to do</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_likelihood</span><span class="o">.</span><span class="n">log_likelihood_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.exclude_measurements" class="name">var <span class="ident">exclude_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.fit_parameters" class="name">var <span class="ident">fit_parameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.include_measurements" class="name">var <span class="ident">include_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.measurement_likelihood" class="name">var <span class="ident">measurement_likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.par_obj" class="name">var <span class="ident">par_obj</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.parameter_likelihood" class="name">var <span class="ident">parameter_likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.Likelihood.parameters_central" class="name">var <span class="ident">parameters_central</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.input_schema">
    <p>def <span class="ident">input_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.input_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.input_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">input_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_input_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">ALLOW_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.load">
    <p>def <span class="ident">load</span>(</p><p>cls, f, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.load" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>cls, d, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">input_schema</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.Likelihood.output_schema">
    <p>def <span class="ident">output_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.Likelihood.output_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.Likelihood.output_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">output_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_output_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">REMOVE_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.MeasurementCovariance" class="name">class <span class="ident">MeasurementCovariance</span></p>
      
  
    <div class="desc"><p>Class to compute, save, and load a covariance matrix and the central
values of experimental measurements.</p>
<p>Methods:</p>
<ul>
<li><code>compute</code>: Compute the covariance</li>
<li><code>get</code>: Compute the covariance if necessary, otherwise return cached one</li>
<li><code>save</code>: Save the covariance to a file</li>
<li><code>load</code>: Load the covariance from a file</li>
<li><code>load_dict</code>: Load the covariance from a dictionary</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MeasurementCovariance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to compute, save, and load a covariance matrix and the central</span>
<span class="sd">    values of experimental measurements.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `compute`: Compute the covariance</span>
<span class="sd">    - `get`: Compute the covariance if necessary, otherwise return cached one</span>
<span class="sd">    - `save`: Save the covariance to a file</span>
<span class="sd">    - `load`: Load the covariance from a file</span>
<span class="sd">    - `load_dict`: Load the covariance from a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_likelihood</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `measurement_likelihood`: an instance of `MeasurementLikelihood`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">measurement_likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values.&quot;&quot;&quot;</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">covariances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="c1"># obs. included in the fit and constrained by this measurement</span>
            <span class="n">our_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="c1"># construct a dict. containing a vector of N random values for</span>
            <span class="c1"># each of these observables</span>
            <span class="n">random_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">random_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> <span class="n">N</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">random_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">random_arr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                    <span class="n">covariance</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">covariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
        <span class="c1"># if there is only a single measuement</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># if there is only a single observable</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if there are severeal measurements, perform a weighted average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># covariances: [Sigma_1, Sigma_2, ...]</span>
            <span class="c1"># means: [x_1, x_2, ...]</span>
            <span class="c1"># weights_ [W_1, W_2, ...] where W_i = (Sigma_i)^(-1)</span>
            <span class="c1"># weighted covariance is  (W_1 + W_2 + ...)^(-1) = Sigma</span>
            <span class="c1"># weigted mean is  Sigma.(W_1.x_1 + W_2.x_2 + ...) = x</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">])</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">weighted_covariance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">]</span>
                <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weighted_covariance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">weighted_mean</span><span class="p">,</span> <span class="n">weighted_covariance</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 5000).</span>

<span class="sd">        If `force` is False, return a cached version if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covariance to a pickle</span>
<span class="sd">        file.</span>

<span class="sd">        The central values and the covariance must have been computed before</span>
<span class="sd">        using `get` or `compute`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covariance from a</span>
<span class="sd">        dictionary.</span>

<span class="sd">        It must have the form</span>
<span class="sd">        `{&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">        where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">        covariance matrix, both in the basis of observables given by</span>
<span class="sd">        &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.&quot;&quot;&quot;</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span> <span class="n">permutation</span><span class="p">],</span>
            <span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.MeasurementCovariance">MeasurementCovariance</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, measurement_likelihood)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the class.</p>
<p>Parameters:
- <code>measurement_likelihood</code>: an instance of <code>MeasurementLikelihood</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_likelihood</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the class.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `measurement_likelihood`: an instance of `MeasurementLikelihood`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span> <span class="o">=</span> <span class="n">measurement_likelihood</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.compute">
    <p>def <span class="ident">compute</span>(</p><p>self, N)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the covariance for <code>N</code> random values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.compute', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.compute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values.&quot;&quot;&quot;</span>
    <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">covariances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="c1"># obs. included in the fit and constrained by this measurement</span>
        <span class="n">our_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="c1"># construct a dict. containing a vector of N random values for</span>
        <span class="c1"># each of these observables</span>
        <span class="n">random_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="n">random_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> <span class="n">N</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                <span class="n">random_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">random_arr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">our_obs</span><span class="p">:</span>
                <span class="n">covariance</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">covariance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
        <span class="n">covariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
    <span class="c1"># if there is only a single measuement</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># if there is only a single observable</span>
            <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># if there are severeal measurements, perform a weighted average</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># covariances: [Sigma_1, Sigma_2, ...]</span>
        <span class="c1"># means: [x_1, x_2, ...]</span>
        <span class="c1"># weights_ [W_1, W_2, ...] where W_i = (Sigma_i)^(-1)</span>
        <span class="c1"># weighted covariance is  (W_1 + W_2 + ...)^(-1) = Sigma</span>
        <span class="c1"># weigted mean is  Sigma.(W_1.x_1 + W_2.x_2 + ...) = x</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">])</span>
            <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">weighted_covariance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">]</span>
            <span class="n">weighted_covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">weighted_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weighted_covariance</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">weighted_mean</span><span class="p">,</span> <span class="n">weighted_covariance</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.get">
    <p>def <span class="ident">get</span>(</p><p>self, N=5000, force=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the covariance for <code>N</code> random values (default: 5000).</p>
<p>If <code>force</code> is False, return a cached version if it exists.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.get', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.get" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 5000).</span>
<span class="sd">    If `force` is False, return a cached version if it exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">5000</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                      <span class="s2">&quot;as experimental covariance has already been &quot;</span> <span class="o">+</span> \
                      <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.load">
    <p>def <span class="ident">load</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the experimental central values and the covriance from a pickle
file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.load" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the experimental central values and the covriance from a pickle</span>
<span class="sd">    file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the the experimental central values and the covariance from a
dictionary.</p>
<p>It must have the form
<code>{'observables': [...], 'central': [...], 'covariance': [[...]]}</code>
where 'central' is a vector of central values and 'covariance' is a
covariance matrix, both in the basis of observables given by
'observables' which must at least contain all the observables
involved in the fit. Additional observables will be ignored; the
ordering is arbitrary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the the experimental central values and the covariance from a</span>
<span class="sd">    dictionary.</span>
<span class="sd">    It must have the form</span>
<span class="sd">    `{&#39;observables&#39;: [...], &#39;central&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">    where &#39;central&#39; is a vector of central values and &#39;covariance&#39; is a</span>
<span class="sd">    covariance matrix, both in the basis of observables given by</span>
<span class="sd">    &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">    involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">    ordering is arbitrary.&quot;&quot;&quot;</span>
    <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
        <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">],</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;central&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">],</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span> <span class="n">permutation</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementCovariance.save">
    <p>def <span class="ident">save</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Save the experimental central values and the covariance to a pickle
file.</p>
<p>The central values and the covariance must have been computed before
using <code>get</code> or <code>compute</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementCovariance.save', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementCovariance.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the experimental central values and the covariance to a pickle</span>
<span class="sd">    file.</span>
<span class="sd">    The central values and the covariance must have been computed before</span>
<span class="sd">    using `get` or `compute`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">central</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_central_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_likelihood</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementCovariance.measurement_likelihood" class="name">var <span class="ident">measurement_likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.MeasurementLikelihood" class="name">class <span class="ident">MeasurementLikelihood</span></p>
      
  
    <div class="desc"><p>A <code>MeasurementLikelihood</code> provides a likelihood function from
experimental measurements.</p>
<p>Methods:</p>
<ul>
<li><code>get_predictions_par</code>: Return a dictionary of SM predictions for the
observables of interest</li>
<li><code>log_likelihood_pred</code>: The likelihood as a function of the predictions</li>
<li><code>log_likelihood_par</code>: The likelihood as a function of parameters and
Wilson coefficients</li>
</ul>
<p>Instances can be imported and exported from/to YAML using the <code>load</code>
and <code>dump</code> methods.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MeasurementLikelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `MeasurementLikelihood` provides a likelihood function from</span>
<span class="sd">    experimental measurements.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `get_predictions_par`: Return a dictionary of SM predictions for the</span>
<span class="sd">    observables of interest</span>
<span class="sd">    - `log_likelihood_pred`: The likelihood as a function of the predictions</span>
<span class="sd">    - `log_likelihood_par`: The likelihood as a function of parameters and</span>
<span class="sd">    Wilson coefficients</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_tuple</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">list_deduplicate</span><span class="p">),</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;observables&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">coerce_observable_dict</span><span class="p">],</span>
        <span class="s1">&#39;exclude_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
        <span class="s1">&#39;include_measurements&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `observables`: list of observables (tuples or strings)</span>
<span class="sd">        - `exclude_measurements`: list of measurement names to exclude</span>
<span class="sd">        (default: none ar excluded)</span>
<span class="sd">        - `include_measurements`: list of measurement names to include</span>
<span class="sd">        (default: all are included)</span>

<span class="sd">        Only one of `exclude_measurements` or `include_measurements` should</span>
<span class="sd">        be specified. By default, all existing instances of</span>
<span class="sd">        `flavio.Measurements` are included as constraints (except if they</span>
<span class="sd">        carry &#39;Pseudo-measurement&#39; in their name).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_pseudo_measurements</span> <span class="o">=</span> <span class="n">include_pseudo_measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>

        <span class="c1"># check that observables are constrained</span>
        <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_warn_meas_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warn the user if the fit contains multiple correlated measurements of</span>
<span class="sd">        an observable that is not included in the fit parameters, as this will</span>
<span class="sd">        lead to inconsistent results.&quot;&quot;&quot;</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># iterate over all measurements constraining at least one fit obs.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># iterate over all fit obs. constrained by this measurement</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">):</span>
                <span class="c1"># the constraint on this fit obs.</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># find all the other obs. constrained by this constraint</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">constraint</span><span class="p">:</span>
                        <span class="n">par</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
                    <span class="c1"># if the other obs. are not fit obs., append them to the list</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">corr_with</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1"># replace list by a Counter</span>
        <span class="n">corr_with</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="c1"># warn for all counts &gt; 1</span>
        <span class="k">for</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">corr_with</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> of the measurements in the likelihood &quot;</span>
                                   <span class="s2">&quot;constrain both &#39;</span><span class="si">{}</span><span class="s2">&#39; and &#39;</span><span class="si">{}</span><span class="s2">&#39;, but only the &quot;</span>
                                   <span class="s2">&quot;latter is included among the fit &quot;</span>
                                   <span class="s2">&quot;observables. This can lead to inconsistent &quot;</span>
                                   <span class="s2">&quot;results as the former is profiled over.&quot;</span>
                                   <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">corr_with</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all the measurements currently defined that</span>
<span class="sd">        constrain any of the fit observables.&quot;&quot;&quot;</span>
        <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">m_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pseudo-measurement&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_pseudo_measurements</span><span class="p">:</span>
                <span class="c1"># skip pseudo measurements generated by FastFit instances</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                <span class="c1"># if set of all observables constrained by measurement is disjoint</span>
                <span class="c1"># with fit observables, do nothing</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># else, add measurement name to output list</span>
                <span class="n">all_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_measurements</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_measurements</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the predictions for all observables as functions of</span>
<span class="sd">        a parameter dictionary `par_dict`and WilsonCoefficient instance</span>
<span class="sd">        `wc_obj`.</span>
<span class="sd">        The latest computed values are cached and returned if the function is</span>
<span class="sd">        called successively with the same arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compute a hash from the function&#39;s arguments used for caching</span>
        <span class="n">arg_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="n">wc_obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">arg_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span><span class="p">:</span>
            <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">argument_format</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">obs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="n">all_predictions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="n">arg_hash</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span>

    <span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">        of observables.&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="n">our_obs</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="n">exclude_observables</span>
            <span class="c1"># add the number of observables contained in the measurement</span>
            <span class="c1"># and in our instance (except the excluded ones)</span>
            <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_obs</span> <span class="o">&amp;</span> <span class="n">our_obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nobs</span>


    <span class="k">def</span> <span class="nf">log_likelihood_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">        a dictionary of observable predictions `pred_dict`&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
            <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
            <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="c1"># exclude the observables not contained in the likelihood</span>
            <span class="c1"># as well as the ones explicitly excluded by `exclude_observables`</span>
            <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="n">m_obs</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">|</span> <span class="n">exclude_observables</span>
            <span class="k">if</span> <span class="n">m_obs</span> <span class="o">==</span> <span class="n">exclude_parameters</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># if all measured observables are excluded: nothing to do</span>
            <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">        a parameter dictionary `par_dict` and WilsonCoefficient instance</span>
<span class="sd">        `wc_obj`&quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_pred</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.MeasurementLikelihood">MeasurementLikelihood</a></li>
          <li>flavio.io.instanceio.YAMLLoadable</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, observables)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the instance.</p>
<p>Parameters:
- <code>observables</code>: list of observables (tuples or strings)
- <code>exclude_measurements</code>: list of measurement names to exclude
(default: none ar excluded)
- <code>include_measurements</code>: list of measurement names to include
(default: all are included)</p>
<p>Only one of <code>exclude_measurements</code> or <code>include_measurements</code> should
be specified. By default, all existing instances of
<code>flavio.Measurements</code> are included as constraints (except if they
carry 'Pseudo-measurement' in their name).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
             <span class="n">exclude_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_pseudo_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `observables`: list of observables (tuples or strings)</span>
<span class="sd">    - `exclude_measurements`: list of measurement names to exclude</span>
<span class="sd">    (default: none ar excluded)</span>
<span class="sd">    - `include_measurements`: list of measurement names to include</span>
<span class="sd">    (default: all are included)</span>
<span class="sd">    Only one of `exclude_measurements` or `include_measurements` should</span>
<span class="sd">    be specified. By default, all existing instances of</span>
<span class="sd">    `flavio.Measurements` are included as constraints (except if they</span>
<span class="sd">    carry &#39;Pseudo-measurement&#39; in their name).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exclude_measurements</span> <span class="o">=</span> <span class="n">exclude_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">include_measurements</span> <span class="o">=</span> <span class="n">include_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">include_pseudo_measurements</span> <span class="o">=</span> <span class="n">include_pseudo_measurements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">exclude_measurements</span> <span class="ow">and</span> <span class="n">include_measurements</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The options exclude_measurements and include_measurements must not be specified simultaneously&quot;</span><span class="p">)</span>
    <span class="c1"># check that observables are constrained</span>
    <span class="n">_obs_measured</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
        <span class="n">_obs_measured</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
    <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_obs_measured</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">missing_obs</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(),</span> <span class="s2">&quot;No measurement found for the observables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing_obs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_warn_meas_corr</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.dump">
    <p>def <span class="ident">dump</span>(</p><p>self, stream=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the objectto a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.dump', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.dump" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the objectto a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yaml_dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.get_number_observations">
    <p>def <span class="ident">get_number_observations</span>(</p><p>self, exclude_observables=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the number of observations, defined as individual measurements
of observables.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.get_number_observations', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.get_number_observations" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">    of observables.&quot;&quot;&quot;</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="n">our_obs</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="n">exclude_observables</span>
        <span class="c1"># add the number of observables contained in the measurement</span>
        <span class="c1"># and in our instance (except the excluded ones)</span>
        <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_obs</span> <span class="o">&amp;</span> <span class="n">our_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nobs</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.get_predictions_par">
    <p>def <span class="ident">get_predictions_par</span>(</p><p>self, par_dict, wc_obj)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the predictions for all observables as functions of
a parameter dictionary <code>par_dict</code>and WilsonCoefficient instance
<code>wc_obj</code>.
The latest computed values are cached and returned if the function is
called successively with the same arguments.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.get_predictions_par', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.get_predictions_par" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the predictions for all observables as functions of</span>
<span class="sd">    a parameter dictionary `par_dict`and WilsonCoefficient instance</span>
<span class="sd">    `wc_obj`.</span>
<span class="sd">    The latest computed values are cached and returned if the function is</span>
<span class="sd">    called successively with the same arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute a hash from the function&#39;s arguments used for caching</span>
    <span class="n">arg_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">par_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="n">wc_obj</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">arg_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span><span class="p">:</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">argument_format</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="n">_inst</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">all_predictions</span><span class="p">[</span><span class="n">observable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inst</span><span class="o">.</span><span class="n">prediction_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span> <span class="o">=</span> <span class="n">all_predictions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_hash</span> <span class="o">=</span> <span class="n">arg_hash</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_cache_values</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.get_yaml_dict">
    <p>def <span class="ident">get_yaml_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the object to a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.get_yaml_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.get_yaml_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_yaml_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the object to a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_schema</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c1"># remove NoneTypes and empty lists</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="p">[]}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_par">
    <p>def <span class="ident">log_likelihood_par</span>(</p><p>self, par_dict, wc_obj, exclude_observables=None, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function as a function of
a parameter dictionary <code>par_dict</code> and WilsonCoefficient instance
<code>wc_obj</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_par', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_par" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">    a parameter dictionary `par_dict` and WilsonCoefficient instance</span>
<span class="sd">    `wc_obj`&quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_pred</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_pred">
    <p>def <span class="ident">log_likelihood_pred</span>(</p><p>self, pred_dict, exclude_observables=None, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the logarithm of the likelihood function as a function of
a dictionary of observable predictions <code>pred_dict</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_pred', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.log_likelihood_pred" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the logarithm of the likelihood function as a function of</span>
<span class="sd">    a dictionary of observable predictions `pred_dict`&quot;&quot;&quot;</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
        <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
        <span class="n">m_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span>
        <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="c1"># exclude the observables not contained in the likelihood</span>
        <span class="c1"># as well as the ones explicitly excluded by `exclude_observables`</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="n">m_obs</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">|</span> <span class="n">exclude_observables</span>
        <span class="k">if</span> <span class="n">m_obs</span> <span class="o">==</span> <span class="n">exclude_parameters</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># if all measured observables are excluded: nothing to do</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">pred_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ll</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementLikelihood.exclude_measurements" class="name">var <span class="ident">exclude_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementLikelihood.get_measurements" class="name">var <span class="ident">get_measurements</span></p>
            

            
  
    <div class="desc"><p>Return a list of all the measurements currently defined that
constrain any of the fit observables.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementLikelihood.include_measurements" class="name">var <span class="ident">include_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementLikelihood.include_pseudo_measurements" class="name">var <span class="ident">include_pseudo_measurements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.MeasurementLikelihood.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.input_schema">
    <p>def <span class="ident">input_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.input_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.input_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">input_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_input_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">ALLOW_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.load">
    <p>def <span class="ident">load</span>(</p><p>cls, f, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.load" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>cls, d, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">input_schema</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.MeasurementLikelihood.output_schema">
    <p>def <span class="ident">output_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.MeasurementLikelihood.output_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.MeasurementLikelihood.output_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">output_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_output_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">REMOVE_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.ParameterLikelihood" class="name">class <span class="ident">ParameterLikelihood</span></p>
      
  
    <div class="desc"><p>A <code>ParameterLikelihood</code> provides a likelihood function in terms of
parameters.</p>
<p>Methods:</p>
<ul>
<li><code>log_likelihood_par</code>: The likelihood as a function of the parameters</li>
<li><code>get_central</code>: get an array with the parameters' central values</li>
<li><code>get_random</code>: get an array with random values for the parameters</li>
</ul>
<p>Instances can be imported and exported from/to YAML using the <code>load</code>
and <code>dump</code> methods.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ParameterLikelihood</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">YAMLLoadable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `ParameterLikelihood` provides a likelihood function in terms of</span>
<span class="sd">    parameters.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `log_likelihood_par`: The likelihood as a function of the parameters</span>
<span class="sd">    - `get_central`: get an array with the parameters&#39; central values</span>
<span class="sd">    - `get_random`: get an array with random values for the parameters</span>

<span class="sd">    Instances can be imported and exported from/to YAML using the `load`</span>
<span class="sd">    and `dump` methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_input_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">All</span><span class="p">([</span><span class="nb">dict</span><span class="p">],</span> <span class="n">iio</span><span class="o">.</span><span class="n">coerce_par_obj</span><span class="p">),</span>
        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">_output_schema_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;par_obj&#39;</span><span class="p">:</span> <span class="n">iio</span><span class="o">.</span><span class="n">get_par_diff</span><span class="p">,</span>
        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">ensurelist</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
                 <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `par_obj`: an instance of `ParameterConstraints` (defaults to</span>
<span class="sd">        `flavio.default_parameters`)</span>
<span class="sd">        - parameters: a list of parameters whose constraints should be taken</span>
<span class="sd">        into account in the likelihood.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prior probability for all parameters.</span>

<span class="sd">        Note that only the parameters in `self.parameters` will give a</span>
<span class="sd">        contribution to the likelihood.&quot;&quot;&quot;</span>
        <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
        <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_central</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with the central values of all parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array with random values for all parameters.&quot;&quot;&quot;</span>
        <span class="n">all_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_random_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">all_random</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.ParameterLikelihood">ParameterLikelihood</a></li>
          <li>flavio.io.instanceio.YAMLLoadable</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, par_obj=&lt;flavio.classes.ParameterConstraints object at 0x7fb9bcfb0940&gt;, parameters=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the instance.</p>
<p>Parameters:</p>
<ul>
<li><code>par_obj</code>: an instance of <code>ParameterConstraints</code> (defaults to
<code>flavio.default_parameters</code>)</li>
<li>parameters: a list of parameters whose constraints should be taken
into account in the likelihood.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">par_obj</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="p">,</span>
             <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the instance.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `par_obj`: an instance of `ParameterConstraints` (defaults to</span>
<span class="sd">    `flavio.default_parameters`)</span>
<span class="sd">    - parameters: a list of parameters whose constraints should be taken</span>
<span class="sd">    into account in the likelihood.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.dump">
    <p>def <span class="ident">dump</span>(</p><p>self, stream=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the objectto a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.dump', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.dump" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the objectto a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yaml_dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.get_yaml_dict">
    <p>def <span class="ident">get_yaml_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Dump the object to a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.get_yaml_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.get_yaml_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_yaml_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the object to a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_schema</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c1"># remove NoneTypes and empty lists</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="p">[]}</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.log_likelihood_par">
    <p>def <span class="ident">log_likelihood_par</span>(</p><p>self, par_dict, delta=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the prior probability for all parameters.</p>
<p>Note that only the parameters in <code>self.parameters</code> will give a
contribution to the likelihood.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.log_likelihood_par', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.log_likelihood_par" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prior probability for all parameters.</span>
<span class="sd">    Note that only the parameters in `self.parameters` will give a</span>
<span class="sd">    contribution to the likelihood.&quot;&quot;&quot;</span>
    <span class="n">exclude_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
    <span class="n">prob_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="o">.</span><span class="n">get_logprobability_all</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">exclude_parameters</span><span class="o">=</span><span class="n">exclude_parameters</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prob_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.ParameterLikelihood.get_central" class="name">var <span class="ident">get_central</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with the central values of all parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.ParameterLikelihood.get_random" class="name">var <span class="ident">get_random</span></p>
            

            
  
    <div class="desc"><p>Return a numpy array with random values for all parameters.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.ParameterLikelihood.par_obj" class="name">var <span class="ident">par_obj</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.ParameterLikelihood.parameters" class="name">var <span class="ident">parameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.ParameterLikelihood.parameters_central" class="name">var <span class="ident">parameters_central</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.input_schema">
    <p>def <span class="ident">input_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.input_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.input_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">input_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_input_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">ALLOW_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.load">
    <p>def <span class="ident">load</span>(</p><p>cls, f, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML string or stream.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.load" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML string or stream.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>cls, d, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiate an object from a YAML dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instantiate an object from a YAML dictionary.&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">input_schema</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">schema</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.ParameterLikelihood.output_schema">
    <p>def <span class="ident">output_schema</span>(</p><p>cls)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.ParameterLikelihood.output_schema', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.ParameterLikelihood.output_schema" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">output_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_output_schema_dict</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">REMOVE_EXTRA</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="flavio.statistics.likelihood.SMCovariance" class="name">class <span class="ident">SMCovariance</span></p>
      
  
    <div class="desc"><p>Class to compute, save, and load a covariance matrix of SM
predictions.</p>
<p>Methods:</p>
<ul>
<li><code>compute</code>: Compute the covariance</li>
<li><code>get</code>: Compute the covariance if necessary, otherwise return cached one</li>
<li><code>save</code>: Save the covariance to a file</li>
<li><code>load</code>: Load the covariance from a file</li>
<li><code>load_dict</code>: Load the covariance from a dictionary</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SMCovariance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to compute, save, and load a covariance matrix of SM</span>
<span class="sd">    predictions.</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `compute`: Compute the covariance</span>
<span class="sd">    - `get`: Compute the covariance if necessary, otherwise return cached one</span>
<span class="sd">    - `save`: Save the covariance to a file</span>
<span class="sd">    - `load`: Load the covariance from a file</span>
<span class="sd">    - `load_dict`: Load the covariance from a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">vary_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">par_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - `observables`: list of observables</span>
<span class="sd">        - `vary_parameters`: parameters to vary. Defaults to &#39;all&#39;.</span>
<span class="sd">        - `par_obj`: instance of ParameterConstraints. Defaults to</span>
<span class="sd">        flavio.default_parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span> <span class="o">=</span> <span class="n">vary_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span> <span class="ow">or</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values, using `threads`</span>
<span class="sd">        CPU threads.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_covariance</span><span class="p">(</span><span class="n">obs_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                                    <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
                                    <span class="n">par_vary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span><span class="p">,</span>
                                    <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
                                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 100),</span>
<span class="sd">        using `threads` CPU threads (default: 1).</span>

<span class="sd">        If `force` is False, return a cached version if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="s2">&quot;as covariance has already been &quot;</span> <span class="o">+</span> \
                          <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>

<span class="sd">        The covariance must have been computed before using `get` or</span>
<span class="sd">        `compute`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="p">,</span>
                        <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>

<span class="sd">        It must have the form `{&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">        where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">        given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">        involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">        ordering is arbitrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
            <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#flavio.statistics.likelihood.SMCovariance">SMCovariance</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, observables)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the class.</p>
<p>Parameters:
- <code>observables</code>: list of observables
- <code>vary_parameters</code>: parameters to vary. Defaults to 'all'.
- <code>par_obj</code>: instance of ParameterConstraints. Defaults to
flavio.default_parameters.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.__init__', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
             <span class="n">vary_parameters</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">par_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the class.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `observables`: list of observables</span>
<span class="sd">    - `vary_parameters`: parameters to vary. Defaults to &#39;all&#39;.</span>
<span class="sd">    - `par_obj`: instance of ParameterConstraints. Defaults to</span>
<span class="sd">    flavio.default_parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span> <span class="o">=</span> <span class="n">vary_parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span> <span class="o">=</span> <span class="n">par_obj</span> <span class="ow">or</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.compute">
    <p>def <span class="ident">compute</span>(</p><p>self, N, threads)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the covariance for <code>N</code> random values, using <code>threads</code>
CPU threads.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.compute', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.compute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values, using `threads`</span>
<span class="sd">    CPU threads.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_covariance</span><span class="p">(</span><span class="n">obs_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span>
                                <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
                                <span class="n">par_vary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vary_parameters</span><span class="p">,</span>
                                <span class="n">par_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_obj</span><span class="p">,</span>
                                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.get">
    <p>def <span class="ident">get</span>(</p><p>self, N=100, threads=1, force=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the covariance for <code>N</code> random values (default: 100),
using <code>threads</code> CPU threads (default: 1).</p>
<p>If <code>force</code> is False, return a cached version if it exists.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.get', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.get" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the covariance for `N` random values (default: 100),</span>
<span class="sd">    using `threads` CPU threads (default: 1).</span>
<span class="sd">    If `force` is False, return a cached version if it exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument N=</span><span class="si">{}</span><span class="s2"> ignored &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> \
                      <span class="s2">&quot;as covariance has already been &quot;</span> <span class="o">+</span> \
                      <span class="s2">&quot;computed. Recompute using `force=True`.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.load">
    <p>def <span class="ident">load</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the SM covariance from a pickle file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.load', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.load" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the SM covariance from a pickle file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.load_dict">
    <p>def <span class="ident">load_dict</span>(</p><p>self, d)</p>
    </div>
    

    
  
    <div class="desc"><p>Load the SM covariance from a dictionary.</p>
<p>It must have the form <code>{'observables': [...], 'covariance': [[...]]}</code>
where 'covariance' is a covariance matrix in the basis of observables
given by 'observables' which must at least contain all the observables
involved in the fit. Additional observables will be ignored; the
ordering is arbitrary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.load_dict', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.load_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the SM covariance from a dictionary.</span>
<span class="sd">    It must have the form `{&#39;observables&#39;: [...], &#39;covariance&#39;: [[...]]}`</span>
<span class="sd">    where &#39;covariance&#39; is a covariance matrix in the basis of observables</span>
<span class="sd">    given by &#39;observables&#39; which must at least contain all the observables</span>
<span class="sd">    involved in the fit. Additional observables will be ignored; the</span>
<span class="sd">    ordering is arbitrary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">),</span> \
        <span class="s2">&quot;Covariance matrix does not contain all necessary entries&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;covariance&#39;</span><span class="p">][</span><span class="n">permutation</span><span class="p">][:,</span><span class="n">permutation</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="flavio.statistics.likelihood.SMCovariance.save">
    <p>def <span class="ident">save</span>(</p><p>self, filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Save the SM covariance to a pickle file.</p>
<p>The covariance must have been computed before using <code>get</code> or
<code>compute</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.statistics.likelihood.SMCovariance.save', this);">Show source &equiv;</a></p>
  <div id="source-flavio.statistics.likelihood.SMCovariance.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the SM covariance to a pickle file.</span>
<span class="sd">    The covariance must have been computed before using `get` or</span>
<span class="sd">    `compute`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Call `get` or `compute` first.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">covariance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="p">,</span>
                    <span class="n">observables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="flavio.statistics.likelihood.SMCovariance.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.SMCovariance.par_obj" class="name">var <span class="ident">par_obj</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="flavio.statistics.likelihood.SMCovariance.vary_parameters" class="name">var <span class="ident">vary_parameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>

    <script>
      renderMathInElement(document.body, options={delimiters:[
  {left: "$$", right: "$$", display: true},
  {left: "\\[", right: "\\]", display: true},
  {left: "\\(", right: "\\)", display: false},
  {left: "$", right: "$", display: false}
]});
    </script>
    <script type="text/javascript">
    $("script[type='math/tex; mode=display']").replaceWith(
      function(){
        var tex = $(this).text();
        return "<span class=\"katex-display\">" +
               katex.renderToString("\\displaystyle "+tex) +
               "</span>";
    });
    </script>

</body>
</html>
